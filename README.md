# SubwayCharge
Visual Studio 2015

## 1. 系统需要实现的任务实现地铁收费系统，要求如下:1. 本系统支持两种乘车卡(单程票、普通卡，详见2.1章节)的使用。2. 乘客须先办理乘车卡，到达目的地后，根据乘车距离和乘车时间进行收费。3. 如余额不足，乘客可对普通票进行充值。4. 系统支持运营一条或多条地铁线路，乘客可通过系统查询地铁线路。5. 本系统使用全命令式操作，具体命令详见第三章“地铁收费系统命令使用说明”。**实战**:* **必须完成**:乘客可通过系统查询地铁乘车卡(不包含单程卡)的消费记录;规则参见“2.4 乘车卡历史消费记录查询说明”，命令参见“查询历史消费记录命令”。* **挑战任务**:运营商可运营多条地铁线路，具体规则参见“2.2地铁线路和相邻站间距信息表”;

## 2. 系统相关规则说明

### 2.1 地铁乘车卡使用规则1、 乘车卡分为两种:(1) 普通卡:普通乘车卡，供乘客多次使用。须通过办理卡片、预充值后使用。 
(2) 单程票:每次乘车根据乘车范围临时换购，单次使用后回收。(3) 老年卡:和普通类似。相比普通卡，特殊时段有优惠。2、 单程卡不支持充值，一次使用后(即扣费时)立即销毁卡信息;3、 普通卡可多次使用，可随时进行充值;4、 本系统最多支持 100 张乘车卡;### 2.2 地铁线路和相邻站间距信息说明
地铁线路的“相邻站间距信息表”:
要求:* 目前只考虑1条地铁线路，无分叉，无环路，任何 2 站点之间的路径是唯一的，不存在多条路径的情况。* 该线路上地铁双向运行。乘客可以从任何站点进站，也可以从任何站点出站。* 相邻站点间的距离大于0千米，小于50千米。* 本系统最多支持100个地铁站，站点名称为“S”+序号，序号的取值范围[0,99]。**挑战目标** 要求:* 运营4条地铁线路，如下图，包括环路、分叉，含多条路径; 
* 查询两个站点间的距离，多条路径中取距离最小的路径。

### 2.3 地铁收费规则说明1、 票价分为基本票价和扣费票价。扣费票价是在基本票价的基础上，根据票卡类型、 时间段进行特殊计算得到的(也有可能等于基本票价)，是扣费操作时需要从卡上 扣除的金额。2、 基本票价计算规则:按进站点与出站点之间的最短里程分级计算: ✓ 3千米(包含3千米，但不包括0)以内:2元。✓ 3千米 至 5千米(包含5千米):3元。✓ 5千米 至 10千米(包含10千米):4元。
✓ 10千米以上:5元。
3、 进出站为同一站点的，则按进出站时长计算:(1) 小于等于 30 分钟:单程票:票卡面值作为扣费票价;其他卡:0 元，且不受任何时间段的限制，即直接作为扣费票价。(2) 大于 30 分钟:单程票:(票卡面值，3 元)中“最大值”作为扣费票价; 其他卡:3 元，且不享受任何时间段的优惠，即直接作为扣费票价。4、 扣费票价计算规则:按照各种票卡的类型计算:✓ 普通卡(C):所有时间段以基本票价作为扣费票价;✓ 老年卡(B):进站时间在[10:00~15:00]以内的，以基本票价的8折作为扣费票价(如出现小数，则向下取整);✓ 单程票(A):即一次性车票，任何时间段不享受任何优惠，直接以(票卡面值，基本票价)中“最大值”作为扣费票价。### 2.4 乘车卡历史消费记录查询说明1、 单程票使用完立即销毁，故不支持历史消费记录查询。2、 普通卡和老年卡支持历史消费记录查询。3、 每张卡最多记录 20 条历史消费记录，记录信息包括:(1) 卡号、卡类别; 
(2) 进站时间、出站时间; 
(3) 进站站点、出站站点; 
(4) 消费金额;## 3 地铁收费系统命令使用说明
### 3.1 地铁收费管理系统命令参数

### 3.2 查询地铁线路命令1、 命令格式L2、 命令返回a) 成功: 返回地铁线路序列;b) 失败: 该命令无失败场景;3、 举例a) 成功举例执行:L返回:地铁线路:S1<->S2<->S3......b) 失败举例无;
### 3.3 购买单程票命令1、 命令格式S [进站站点名称] [出站站点名称] 说明:执行命令成功后，系统默认为单程票充值，充值额度等于真实票价。2、 命令返回a) 成功:购买单程票<成功><卡号=><卡类型=单程卡><余额=>;b) 失败:购买单程票<失败><失败原因=*>

3、 举例a) 成功举例执行:S S1 S5返回:购买单程票<成功><卡号=1><卡类型=单程卡><余额=4>b) 失败举例执行:S S1 S1000 返回:购买单程票<失败><失败原因=无效的线路号>
### 3.4 办理乘车卡命令1、 命令格式B [卡类型] [预存金额]2、 命令返回a) 成功:办理乘车卡<成功><卡号=><卡类型=><余额=>b) 失败:办理乘车卡<失败><失败原因=>3、 举例a) 成功举例 执行:B C 100返回:办理乘车卡<成功><卡号=0><卡类型=普通卡><余额=100>b) 失败举例执行:B Z 100 返回:办理乘车卡<失败><失败原因=无效的卡类型>### 3.5 乘车扣费命令1、 命令格式C [卡号] [进站时间] [进站站点名称] [出站时间] [出站站点名称]2、 命令返回a) 成功:乘车卡扣费<成功><卡号=*><卡类型=*><余额=>b) 失败:乘车卡扣费<失败><卡号=*><卡类型=*><余额=*><失败原因=*>3、 举例a) 成功举例执行:C 1 12:00 S1 13:00 S2 返回:乘车卡扣费<成功><卡号=1><卡类型=单程卡><余额=0>b) 失败举例
执行:C 2 12:00 S1 13:00 S10返回:乘车卡扣费<失败><卡号=2><卡类型=单程卡><余额=2><失败原因= 余额不足>### 3.6 乘车卡充值命令1、 命令格式F [卡号] [预存金额]2、 命令返回a) 成功:乘车卡充值<成功><卡号=*><卡类型=*><余额=>b) 失败:乘车卡充值<失败><卡号=*><卡类型=*><失败原因=>3、 举例a) 成功举例 执行:F 3 100返回:乘车卡充值<成功><卡号=3><卡类型=普通卡><余额=200>b) 失败举例执行:F 1 100返回:乘车卡充值<失败><卡号=1><卡类型=未知卡类型><失败原因=无效的地铁卡>### 3.7 重置系统命令说明:该命令是一个可测试性需求，执行该命令后，通过客户端创建的票卡信息全部清 除，系统回到初始态。1、 命令格式R2、 命令返回a) 成功: 重置系统<成功>b) 失败: 该命令不允许失败。### 3.8 查询历史消费记录命令1、 命令格式 H [卡号]2、 命令返回 
a) 成功:
查询<成功><卡号=*><卡类型=*>
<序号=1,进站时间=*,进站站点=*,出站时间=*,出站站点=*,消费金额=>
<序号=2,进站时间=*,进站站点=*,出站时间=*,出站站点=*,消费金额=>b) 失败: 查询<失败><卡号=*><卡类型=*><失败原因=>3、 举例a) 成功举例执行:H 1 返回:查询<成功><卡号=0><卡类型=老年卡><序号=1,进站时间=10:01,进站站点=S1,出站时间=10:30,出站站点 =S10,消费金额=4><序号=2,进站时间=14:01,进站站点=S10,出站时间=14:30,出站站 点=S1,消费金额=4>b) 失败举例 执行:H 1000返回: 查询<失败><卡号=1000><卡类型=未知卡类型><失败原因=无效的地铁卡>### 3.9 命令执行错误码


XYF

